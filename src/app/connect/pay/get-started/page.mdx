import {
	OpenSourceCard,
	ArticleIconCard,
	Callout,
	DocImage,
	Stack,
	createMetadata,
	Steps,
	Step,
} from "@doc";
import { GraduationCap } from "lucide-react";
import payApiKeyImage from "../assets/pay-api-key.png";

export const metadata = createMetadata({
	image: {
		title: "thirdweb Pay - Buy With Crypto - Get Started",
		icon: "pay",
	},
	title: "thirdweb Pay - Buy With Crypto | thirdweb",
	description:
		"Learn how to get a quote and send a transaction with the thirdweb SDK",
});

# Get Started

In this guide, weâ€™ll walk you through getting a quote and sending a transaction with our Typescript SDK. Once set up, your app will be able to provide crypto purchases for users.

## Using the Connect UI

Buy With Crypto comes by default with our Connect UI component. Follow [this guide](/typescript/v5/react/components/ConnectButton) to integrate Connect into your application.

## Starting from existing project

<Steps>

<Step title="Install the required packages">

```bash
npm install thirdweb
```

</Step>

<Step title="Get your client ID">

To enable Buy With Crypto in your applications you will need your client ID. You can get one for free on [your thirdweb dashboard](https://thirdweb.com/create-api-key) by creating an API key.

</Step>

<Step title="Get A Buy Quote">
Initiaing a buy on behalf of your users involves two steps: getting a quote and sending a transaction. To get a quote, you can use the `useBuyWithCryptoQuote` hook with the following parameters:

- **fromAddress:** The address of the wallet initiating the transaction.
- **fromTokenAddress:** The contract address of the source token.
- **fromChainId**: The chain id of the source token.
- **toTokenAddress:** The contract address of the destination token.
- **toChainId:** The chain id of the destination token.
- **client**: A thirdweb client instance instantiated with your client ID.
- **toAmount**: The amount of the token you owant to purchase.

```ts
import { createThirdwebClient } from "thirdweb";
import { ThirdwebProvider, useBuyWithCryptoQuote, useActiveAccount } from "thirdweb/react";


const client = createThirdwebClient({
  clientId: "<your_client_id>",
});

// change me!
const fromChainId = 1;
const toChainId = 10;

function Component() {
	const account = useActiveAccount();
	const buyWithCryptoQuoteQuery = useBuyWithCryptoQuote({
		fromAddress: account.address,
		fromChainId,
		fromTokenAddress: NATIVE_TOKEN_ADDRESS,
		toChainId,
		toTokenAddress: NATIVE_TOKEN_ADDRESS,
		toAmount: 1,
	});

	return <button>Buy</button>;
}

function App() {
	return (
		<ThirdwebProvider client={client}>
			<ConnectButton />
			<Component />
		</ThirdwebProvider>
	);
}
```

</Step>

<Step title="Send a Transaction">
Once you&apos;ve received a quote, you can execute a buy by utilizing `useSendTransaction` hook. Note that buy with non-native ERC20s may require an extra approval request:

```ts
import { useBuyWithCryptoQuote, useActiveAccount, useSendTransaction } from "thirdweb/react";

// change me!
const fromChainId = 1;
const toChainId = 10;

function Component(buyWithCryptoQuoteQuery) {
	{/* From before */}
 	const account = useActiveAccount();
	const buyWithCryptoQuoteQuery = useBuyWithCryptoQuote({
		fromAddress: account.address,
		fromChainId,
		fromTokenAddress: NATIVE_TOKEN_ADDRESS,
		toChainId,
		toTokenAddress: NATIVE_TOKEN_ADDRESS,
		toAmount: 1,
	});

	{/* New! */}
	const sendTransactionMutation = useSendTransaction();

	async function handleBuyWithCrypto() {
		// if approval is required
		if (buyWithCryptoQuoteQuery.data.approval) {
			await sendTransactionMutation.mutateAsync(buyWithCryptoQuoteQuery.data.approval);
		}
		// send the transaction to buy crypto
		// this promise is resolved when user confirms the transaction in the wallet
		// and the transaction is sent to the blockchain
		const buyWithCryptoTxn = await sendTransactionMutation.mutateAsync(buyWithCryptoQuoteQuery.data.transactionRequest);
	}

	return <button onClick={handleBuyWithCrypto}>Buy</button>
}
```

</Step>

<Step title="Listening to the transaction status">
Once you&apos; submitted your transaction, you can listen to the transaction status using the `useBuyWithCryptoStatus` hook. This hook will update as the transaction status changes. Note that some purchase can take a while to complete, so it's best to show some sort of loading indicator.

```ts
 import { useSendTransaction, useBuyWithCryptoQuote, useBuyWithCryptoStatus, type BuyWithCryptoStatusQueryParams } from "thirdweb/react";

 function Listener(props: BuyWithCryptoStatusQueryParams) {
  const buyWithCryptoStatusQuery = useBuyWithCryptoStatus(props);

  return <pre>{JSON.stringify(buyWithCryptoStatusQuery.data, null, 2)}</pre>
 }
```

</Step>

</Steps>

And that's it! You're ready to start buying with crypto.

## Next Steps

Head on over to our advanced guides to learn more about handling Buy With Crypto transactions:

- [**Fee Sharing**](/connect/pay/fee-sharing)
- [**Get Transaction Status**](/connect/pay/get-transaction-status)
